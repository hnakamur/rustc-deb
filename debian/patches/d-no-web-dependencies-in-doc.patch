Description: Use local web resources instead of remote ones
Author: Matthijs van Otterdijk <matthijs@wirevirt.net>
Bug: https://github.com/azerupi/mdBook/issues/271
---
This patch header follows DEP-3: http://dep.debian.net/deps/dep3/
--- a/src/vendor/mdbook/src/theme/index.hbs
+++ b/src/vendor/mdbook/src/theme/index.hbs
@@ -10,27 +10,19 @@
         <base href="{{ path_to_root }}">
 
         <link rel="stylesheet" href="book.css">
-        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
-        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">
 
         <link rel="shortcut icon" href="{{ favicon }}">
 
         <!-- Font Awesome -->
-        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
+        <link rel="stylesheet" href="../font-awesome.min.css">
 
-        <link rel="stylesheet" href="highlight.css">
+        <link rel="stylesheet" href="../highlight.css">
         <link rel="stylesheet" href="tomorrow-night.css">
 
         <!-- MathJax -->
-        <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
+        <script type="text/javascript" src="../mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
-        <!-- Fetch JQuery from CDN but have a local fallback -->
-        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
-        <script>
-            if (typeof jQuery == 'undefined') {
-                document.write(unescape("%3Cscript src='jquery.js'%3E%3C/script%3E"));
-            }
-        </script>
+        <script src="../jquery.min.js"></script>
     </head>
     <body class="light">
         <!-- Set the theme before any content is loaded, prevents flash -->
@@ -101,17 +93,10 @@
         </div>
 
 
-        <!-- Local fallback for Font Awesome -->
-        <script>
-            if ($(".fa").css("font-family") !== "FontAwesome") {
-                $('<link rel="stylesheet" type="text/css" href="_FontAwesome/css/font-awesome.css">').prependTo('head');
-            }
-        </script>
-
         <!-- Livereload script (if served using the cli tool) -->
         {{{livereload}}}
 
-        <script src="highlight.js"></script>
+        <script src="../highlight.js"></script>
         <script src="book.js"></script>
     </body>
 </html>
--- a/src/vendor/mdbook/.cargo-checksum.json
+++ b/src/vendor/mdbook/.cargo-checksum.json
@@ -1 +1 @@
-{"files":{".cargo-ok":"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",".gitignore":"7fc53e58ea4fc231547669915c3aa5c935160fad031fec21dea2bb3b16a15b2a",".travis.yml":"d731d3f863b67b45fff35ac820cd8e59fbf9bd2f31945eb95a81efd663d02d6f","Cargo.toml":"4b8e1b67da1a09bdc4487e2dee85203e9ef1aa139eca5cb0d8426bd611c4f250","LICENSE":"af175b9d96ee93c21a036152e1b905b0b95304d4ae8c2c921c7609100ba8df7e","README.md":"83aecab607b1ee604474919ff6cb5656cbdfe5fb19434ba9e376e8c0ea31a4ef","appveyor.yml":"a668f162445352248c2959a4a2cdbc841a65e720315ed63465a5e2a496da8fc3","build.rs":"a4a6cae4865610b7f072d49d6a207aa347b224f1599a1f8040319238794d78ab","ci/before_deploy.sh":"315c72bd54e3a06523cd4b578fba03aa77ffa719585e355f6af53d83b6186ef3","ci/install.sh":"0bd60e5dd47a8abe15fcb8a24321b3d41eeab2c831e7b6c0a698a8e14243362e","ci/script.sh":"200d93a045f609cddf76e300b972d39482611d562b47c6db6cee43574023c319","deploy.sh":"a1ac4451da71df79d33bfebe8cdf551a6108a458c3e05b6f0cd88e834e16f207","rustfmt.toml":"6b70725f7f74ddf6156780fb848f1bbad19002a5ebd613cdd2eed886e8a7bc08","src/bin/mdbook.rs":"6bf068173d3c56af9dcf07a8e2f525474ad45d8e2dcfd854a2502f658ae899f0","src/book/bookconfig.rs":"5f7ce7990b040fb72473a79985498eb03c8c6a583b925b29045a9edbe64c4467","src/book/bookconfig_test.rs":"1cfc10c752e17ac4fde86ab5f98a5bf27b30d2a1a6de29f4b3dd2e9abd48a893","src/book/bookitem.rs":"6b7e0c1ac396a5ec7c173de5b598db64aa877237a703d2d13d28848987462d5b","src/book/mod.rs":"c78de3cb014501a7cc009becc4116fcddd4c1842c1e6cd3a3e0a5a8ba059e851","src/lib.rs":"1d6d728909373153ede38ccfe0425113a8a05b1d53477cedbc1535327b3b7938","src/parse/mod.rs":"7f84c961253464c84da440a0c6970607e5f80fffcf85ea417ac7e5f16b85ff26","src/parse/summary.rs":"92ab07cc076ab4d455538c347ec93c6a875a9485481f780d91ae20735916c973","src/renderer/html_handlebars/hbs_renderer.rs":"d2f9c345f32042840e6cb38903434fed160ae30977289c89c06e8499b429b2f5","src/renderer/html_handlebars/helpers/mod.rs":"7e7a9af12ddb4f06b6672b13b8b82dc698c7f95716830f2338f73715589c51ea","src/renderer/html_handlebars/helpers/navigation.rs":"5a7fe4e223fbd096ca32ba9112b202716ff45ba15f8962328c62438ea198bdd3","src/renderer/html_handlebars/helpers/playpen.rs":"096b3821703235c5ce7abfee0541f87790842cd98624a13788720ec4b51fb780","src/renderer/html_handlebars/helpers/toc.rs":"da6d2554d5dea053a692d73f3946dceb372815383336ab767c0b4bbee5c59c8b","src/renderer/html_handlebars/mod.rs":"b59451bbd082b10ead4a1b4ef27496a64381e609ced7dcfd0e4fd15ecb03e996","src/renderer/mod.rs":"5d01bb20dbdac8cdd01cbd4b3ad2baac34521cacd4e19163eec001cb753801c3","src/theme/_FontAwesome/css/font-awesome.min.css":"936ffccdc35bc55221e669d0e76034af76ba8c080c1b1149144dbbd3b5311829","src/theme/_FontAwesome/fonts/FontAwesome.otf":"7961070f76a33c1307de19ce2a93dc2b26d6747fa759aee5045118644c758acc","src/theme/_FontAwesome/fonts/fontawesome-webfont.eot":"d4f5a99224154f2a808e42a441ddc9248ffe78b7a4083684ce159270b30b912a","src/theme/_FontAwesome/fonts/fontawesome-webfont.svg":"7414288c272f6cc10304aa18e89bf24fb30f40afd644623f425c2c3d71fbe06a","src/theme/_FontAwesome/fonts/fontawesome-webfont.ttf":"1b7f3de49d68b01f415574ebb82e6110a1d09cda2071ad8451bdb5124131a292","src/theme/_FontAwesome/fonts/fontawesome-webfont.woff":"a7c7e4930090e038a280fd61d88f0dc03dad4aeaedbd8c9be3dd9aa4c3b6f8d1","src/theme/_FontAwesome/fonts/fontawesome-webfont.woff2":"3c4a1bb7ce3234407184f0d80cc4dec075e4ad616b44dcc5778e1cfb1bc24019","src/theme/book.css":"faa68e7fb58e00934baedf9bb60a4187f2568cf1b10736d9c9592adfd5c249f0","src/theme/book.js":"461df0f6998eb8c585362e4bfc84c2b29f46948025ba7f6221f88104c94ce527","src/theme/favicon.png":"8114d1fc74f4b5621ad9afde7746ed9cf7e420be317a6e29023d2298d58aa15b","src/theme/highlight.css":"e5c723e9ac733f76838f992e66b73c470865a42eeb07a4db71f4dca7628c3ac5","src/theme/highlight.js":"37ace44c6a45f7b68004c7264ccf29a1bafa2a8f737cf48525914b3e9984bdf8","src/theme/index.hbs":"5e83292c4522aca17ff47c28648709314dcd9912fa391e44a11e9e2e817d042f","src/theme/jquery-2.1.4.min.js":"f16ab224bb962910558715c82f58c10c3ed20f153ddfaa199029f141b5b0255c","src/theme/mod.rs":"4f8d40c66f1dadf94a714ed9b7e5821c2078837c6b4d20ee22e9945125466c3c","src/theme/stylus/book.styl":"22bec9f79e1a49904824cbcb007c06ab46a5ecabb9058e0165d62972dfa0b8e0","src/theme/stylus/general.styl":"50c86eaeee69f3b15aca150aeb39fd370dd66831db2935344ec88d6e783c29d7","src/theme/stylus/menu.styl":"c4990d4852275b6cac8201ef03ce7fb3c657a4f0630dfcbaab8f62af2b8f9446","src/theme/stylus/nav-icons.styl":"aae03f9a9927c5e3b17504227c18c2e1542581dccb10fcaa65f3b348a326bf47","src/theme/stylus/page.styl":"624960299de334cf1ff3075ed23742c441199e6811984a0f1f7a8f6246b2cc5e","src/theme/stylus/print.styl":"89a714a5c376f01a211f1f5b79ae1e2ef241dbee150d09563e6d0cd2e6b6c424","src/theme/stylus/sidebar.styl":"7a7a501f1d824375532b6f3e97e53980e176bccfae6b542fff73c660ac543c68","src/theme/stylus/theme-popup.styl":"c9f1c75c5e7e2ddef8f7fdf50749d29b3819a0410378bf1424f6cdac5f3bda1e","src/theme/stylus/themes/base.styl":"cf4ba427c9fea01ca17db9af457e60ee9936d2cff1439278d549d8b200979687","src/theme/stylus/themes/coal.styl":"151ccd7de802ac319787b2a7f0e13286dcfb203f730e7324b156760167b486e9","src/theme/stylus/themes/index.styl":"4afadc7eb2fdd29408cd8ec0f2d37948a98040994a7142b3d114ae61214e6d21","src/theme/stylus/themes/light.styl":"7cf535638cdca25c94b87613facbd52036d10222144f838e8410a4e9ffd3f8e1","src/theme/stylus/themes/navy.styl":"065dad59ccee44d075805e60a07987d6d80d72051f496ec89341b1d3096c429c","src/theme/stylus/themes/rust.styl":"6aeb5a69df72824edbcf8ae963dc48b5766311eb0d03b4ecc6e9f0f32a8b0783","src/theme/stylus/variables.styl":"cd8cf21678e86104d21a2a84dae192f1b8b1ed39a912363428ae958052376aa0","src/theme/tomorrow-night.css":"c914fd853acc9b53301a97948476de8a8ffd3e40f5bbd4f5d62ff42819558b82","src/utils/fs.rs":"a383300135a988e3db0b8f7198c00cf538ce2439d233f554aa50edd2a7bcea5a","src/utils/mod.rs":"a7e7271c6528b3a8dbcf6c5eb76446bf9b5f9e5acf90a8e52ed2219b8fc61eff"},"package":"f1e2e9d848514dcfad4195788d0d42ae5153a477c191d75d5b84fab10f222fbd"}
\ No newline at end of file
+{"files":{},"package":"2598843aeda0c5bb2e8e4d714564f1c3fc40f7844157e34563bf96ae3866b56e"}
--- a/src/vendor/mdbook/src/theme/mod.rs
+++ b/src/vendor/mdbook/src/theme/mod.rs
@@ -7,17 +7,7 @@
 pub static CSS: &'static [u8] = include_bytes!("book.css");
 pub static FAVICON: &'static [u8] = include_bytes!("favicon.png");
 pub static JS: &'static [u8] = include_bytes!("book.js");
-pub static HIGHLIGHT_JS: &'static [u8] = include_bytes!("highlight.js");
 pub static TOMORROW_NIGHT_CSS: &'static [u8] = include_bytes!("tomorrow-night.css");
-pub static HIGHLIGHT_CSS: &'static [u8] = include_bytes!("highlight.css");
-pub static JQUERY: &'static [u8] = include_bytes!("jquery-2.1.4.min.js");
-pub static FONT_AWESOME: &'static [u8] = include_bytes!("_FontAwesome/css/font-awesome.min.css");
-pub static FONT_AWESOME_EOT: &'static [u8] = include_bytes!("_FontAwesome/fonts/fontawesome-webfont.eot");
-pub static FONT_AWESOME_SVG: &'static [u8] = include_bytes!("_FontAwesome/fonts/fontawesome-webfont.svg");
-pub static FONT_AWESOME_TTF: &'static [u8] = include_bytes!("_FontAwesome/fonts/fontawesome-webfont.ttf");
-pub static FONT_AWESOME_WOFF: &'static [u8] = include_bytes!("_FontAwesome/fonts/fontawesome-webfont.woff");
-pub static FONT_AWESOME_WOFF2: &'static [u8] = include_bytes!("_FontAwesome/fonts/fontawesome-webfont.woff2");
-pub static FONT_AWESOME_OTF: &'static [u8] = include_bytes!("_FontAwesome/fonts/FontAwesome.otf");
 
 /// The `Theme` struct should be used instead of the static variables because the `new()` method
 /// will look if the user has a theme directory in his source folder and use the users theme instead
@@ -30,10 +20,7 @@
     pub css: Vec<u8>,
     pub favicon: Vec<u8>,
     pub js: Vec<u8>,
-    pub highlight_css: Vec<u8>,
     pub tomorrow_night_css: Vec<u8>,
-    pub highlight_js: Vec<u8>,
-    pub jquery: Vec<u8>,
 }
 
 impl Theme {
@@ -45,10 +32,7 @@
             css: CSS.to_owned(),
             favicon: FAVICON.to_owned(),
             js: JS.to_owned(),
-            highlight_css: HIGHLIGHT_CSS.to_owned(),
             tomorrow_night_css: TOMORROW_NIGHT_CSS.to_owned(),
-            highlight_js: HIGHLIGHT_JS.to_owned(),
-            jquery: JQUERY.to_owned(),
         };
 
         // Check if the given path exists
@@ -82,18 +66,6 @@
             let _ = f.read_to_end(&mut theme.favicon);
         }
 
-        // highlight.js
-        if let Ok(mut f) = File::open(&src.join("highlight.js")) {
-            theme.highlight_js.clear();
-            let _ = f.read_to_end(&mut theme.highlight_js);
-        }
-
-        // highlight.css
-        if let Ok(mut f) = File::open(&src.join("highlight.css")) {
-            theme.highlight_css.clear();
-            let _ = f.read_to_end(&mut theme.highlight_css);
-        }
-
         // tomorrow-night.css
         if let Ok(mut f) = File::open(&src.join("tomorrow-night.css")) {
             theme.tomorrow_night_css.clear();
--- a/src/vendor/mdbook/src/renderer/html_handlebars/hbs_renderer.rs
+++ b/src/vendor/mdbook/src/renderer/html_handlebars/hbs_renderer.rs
@@ -162,17 +162,7 @@
         try!(book.write_file("book.js", &theme.js));
         try!(book.write_file("book.css", &theme.css));
         try!(book.write_file("favicon.png", &theme.favicon));
-        try!(book.write_file("jquery.js", &theme.jquery));
-        try!(book.write_file("highlight.css", &theme.highlight_css));
         try!(book.write_file("tomorrow-night.css", &theme.tomorrow_night_css));
-        try!(book.write_file("highlight.js", &theme.highlight_js));
-        try!(book.write_file("_FontAwesome/css/font-awesome.css", theme::FONT_AWESOME));
-        try!(book.write_file("_FontAwesome/fonts/fontawesome-webfont.eot", theme::FONT_AWESOME_EOT));
-        try!(book.write_file("_FontAwesome/fonts/fontawesome-webfont.svg", theme::FONT_AWESOME_SVG));
-        try!(book.write_file("_FontAwesome/fonts/fontawesome-webfont.ttf", theme::FONT_AWESOME_TTF));
-        try!(book.write_file("_FontAwesome/fonts/fontawesome-webfont.woff", theme::FONT_AWESOME_WOFF));
-        try!(book.write_file("_FontAwesome/fonts/fontawesome-webfont.woff2", theme::FONT_AWESOME_WOFF2));
-        try!(book.write_file("_FontAwesome/fonts/FontAwesome.ttf", theme::FONT_AWESOME_TTF));
 
         // Copy all remaining files
         try!(utils::fs::copy_files_except_ext(book.get_src(), book.get_dest(), true, &["md"]));
--- a/src/tools/linkchecker/main.rs
+++ b/src/tools/linkchecker/main.rs
@@ -149,6 +149,11 @@
            url.starts_with("irc:") || url.starts_with("data:") {
             return;
         }
+        // Ignore parent URLs, so that the package installation process can
+        // provide a symbolic link later
+        if url.starts_with("../") {
+            return;
+        }
         let mut parts = url.splitn(2, "#");
         let url = parts.next().unwrap();
         let fragment = parts.next();
--- a/src/vendor/mdbook/src/book/mod.rs
+++ b/src/vendor/mdbook/src/book/mod.rs
@@ -285,14 +285,6 @@
         let mut js = try!(File::create(&theme_dir.join("book.js")));
         try!(js.write_all(theme::JS));
 
-        // highlight.css
-        let mut highlight_css = try!(File::create(&theme_dir.join("highlight.css")));
-        try!(highlight_css.write_all(theme::HIGHLIGHT_CSS));
-
-        // highlight.js
-        let mut highlight_js = try!(File::create(&theme_dir.join("highlight.js")));
-        try!(highlight_js.write_all(theme::HIGHLIGHT_JS));
-
         Ok(())
     }
 
--- a/src/doc/book/second-edition/theme/index.hbs
+++ b/src/doc/book/second-edition/theme/index.hbs
@@ -10,14 +10,13 @@
         <base href="{{ path_to_root }}">
 
         <link rel="stylesheet" href="book.css">
-        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
 
         <link rel="shortcut icon" href="{{ favicon }}">
 
         <!-- Font Awesome -->
-        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
+        <link rel="stylesheet" href="../font-awesome.min.css">
 
-        <link rel="stylesheet" href="highlight.css">
+        <link rel="stylesheet" href="../highlight.css">
         <link rel="stylesheet" href="tomorrow-night.css">
         <style>
             .page-wrapper.has-warning > .nav-chapters {
@@ -67,15 +66,9 @@
         </style>
 
         <!-- MathJax -->
-        <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
+        <script type="text/javascript" src="../mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
-        <!-- Fetch JQuery from CDN but have a local fallback -->
-        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
-        <script>
-            if (typeof jQuery == 'undefined') {
-                document.write(unescape("%3Cscript src='jquery.js'%3E%3C/script%3E"));
-            }
-        </script>
+        <script src="../jquery.min.js"></script>
     </head>
     <body class="light">
         <!-- Set the theme before any content is loaded, prevents flash -->
@@ -148,13 +141,6 @@
         </div>
 
 
-        <!-- Local fallback for Font Awesome -->
-        <script>
-            if ($(".fa").css("font-family") !== "FontAwesome") {
-                $('<link rel="stylesheet" type="text/css" href="_FontAwesome/css/font-awesome.css">').prependTo('head');
-            }
-        </script>
-
         <!-- Livereload script (if served using the cli tool) -->
         {{{livereload}}}
 
